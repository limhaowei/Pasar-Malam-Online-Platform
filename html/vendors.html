<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/simple-line-icons.css" rel="stylesheet" />
    <link href="css/themify-icons.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <title>Vendors</title>
  </head>

  <body>
    <div class="nav-menu">
      <div class="bg transition">
        <div class="container-fluid fixed is-sticky">
          <div class="row">
            <div class="col-md-12">
              <nav class="navbar navbar-expand-lg navbar-light">
                <a class="navbar-brand" href="index.html">Lorong Belakang</a>
                <div class="navbar-collapse justify-content-end">
                  <ul class="navbar-nav">
                    <li class="nav-item">
                      <a class="nav-link" href="vendors.html">Vendors</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="user-guide.html">User Guide</a>
                    </li>
                    <li class="nav-item">
                      <a class="btn btn-outline-light top-btn" href="login.html"
                        >Sign In</a
                      >
                    </li>
                    <li class="nav-item dropdown">
                      <a class="btn btn-outline-light dropbtn">
                        <span class="ti-plus"></span> Register
                      </a>
                      <div class="dropdown-content">
                        <a href="register-user.html">User</a>
                        <a href="register-vendor.html">Vendor</a>
                      </div>
                    </li>
                  </ul>
                </div>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section class="main-block light-bg" id="vendors">
      <div class="container">
        <div class="row mb-3">
          <div class="col-md-4">
            <select id="searchCriteria" class="form-section search">
              <option value="name">Search by Name</option>
              <option value="business_type">Search by Business Type</option>
            </select>
          </div>
          <div class="col-md-8">
            <input
              type="text"
              id="vendorSearch"
              class="form-section search"
              placeholder="Search for vendors..."
            />
          </div>
        </div>
        <div class="row" id="vendor-list">
          <!-- Vendors will be loaded here -->
        </div>
      </div>
    </section>

    <footer class="main-block dark-bg">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="copyright">
              <p>
                Copyright &copy;
                <script>
                  document.write(new Date().getFullYear());
                </script>
                Youth Ventures Asia. <br />All rights reserved.
              </p>

              <ul>
                <li>
                  <a
                    href="https://www.facebook.com/lorongbelakangcyberjaya/?locale=ms_MY"
                    target="_blank"
                    ><span class="ti-facebook"></span
                  ></a>
                </li>
                <li>
                  <a
                    href="https://www.instagram.com/lorongbelakangcyberjaya/"
                    target="_blank"
                    ><span class="ti-instagram"></span
                  ></a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script src="scripts/jQuery-3.7.1.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>

    <script>
      // Mock vendor data for demonstration
      // TODO: write function to fetch vendors data from database
      let vendors = [
        {
          name: "Food 1",
          type: "Food",
          rating: "65",
          phone: "1234567890",
          social: "Social 1",
          image: "images/featured1.jpg",
        },
        {
          name: "Fashion 1",
          type: "Fashion",
          rating: "60",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Decoration 3",
          type: "Decoration",
          rating: "70",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 4",
          type: "Fashion",
          rating: "80",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 5",
          type: "Type 2",
          rating: "58",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 6",
          type: "Type 2",
          rating: "100",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 7",
          type: "Type 2",
          rating: "73",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 8",
          type: "Type 2",
          rating: "36",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 9",
          type: "Type 2",
          rating: "15",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 10",
          type: "Type 2",
          rating: "20",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 11",
          type: "Type 2",
          rating: "10",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 12",
          type: "Type 2",
          rating: "100",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
        {
          name: "Vendor 13",
          type: "Type 2",
          rating: "70",
          phone: "0987654321",
          social: "Social 2",
          image: "images/featured2.jpg",
        },
      ];

      let loadedVendors = 0;
      const vendorsPerLoad = 6;

      function createStarRating(rating, vendorIndex) {
        let starHtml = '';
        for (let i = 1; i <= 5; i++) {
            const starId = `rate-${vendorIndex}-${i}`;
            starHtml += `
                <input type="radio" name="rate-${vendorIndex}" id="${starId}" ${i === rating ? 'checked' : ''}>
                <label for="${starId}" class="fa fa-star"></label>
            `;
        }
        return starHtml;
      }

      function loadVendors() {
        const vendorList = document.getElementById("vendor-list");
        const fragment = document.createDocumentFragment();

        for (
          let i = loadedVendors;
          i < loadedVendors + vendorsPerLoad && i < vendors.length;
          i++
        ) {
          const vendor = vendors[i];
          const vendorElement = document.createElement("div");
          vendorElement.className = "col-md-4 featured-responsive vendor-item";
          vendorElement.innerHTML = `
                <div class="vendor-wrap">
                    <a href="detail.html">
                        <img alt="#" class="img-fluid" src="${vendor.image}"/>
                        <div class="vendor-title-box">
                          <h6>${vendor.name}
                            <div class="star-widget">${createStarRating(vendor.rating, i)}</div></h6>
                            <p>${vendor.type}</p>
                            <ul class="address">
                                <li><span class="icon-screen-smartphone"></span><p>${vendor.phone}</p></li>
                                <li><span class="icon-link"></span><p>${vendor.social}</p></li>
                            </ul>
                        </div>
                    </a>
                </div>
            `;
          fragment.appendChild(vendorElement);
        }

        vendorList.appendChild(fragment);
        loadedVendors += vendorsPerLoad;
      }

      function handleScroll() {
        const scrollTop =
          window.pageYOffset || document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;

        if (scrollTop + clientHeight >= scrollHeight - 5) {
          loadVendors();
        }
      }

      function handleSearch() {
        const query = document
          .getElementById("vendorSearch")
          .value.toLowerCase();
        const searchCriteria = document.getElementById("searchCriteria").value;
        const vendorList = document.getElementById("vendor-list");

        // Reset result
        vendorList.innerHTML = "";

        // Filter vendors based on the search criteria
        const filteredVendors = vendors.filter((vendor) => {
          const name = vendor.name.toLowerCase();
          const businessType = vendor.type.toLowerCase();

          if (searchCriteria === "name" && name.includes(query)) {
            return true;
          } else if (
            searchCriteria === "business_type" &&
            businessType.includes(query)
          ) {
            return true;
          }
          return false;
        });

        // Display filtered vendors
        const fragment = document.createDocumentFragment();
        filteredVendors.forEach((vendor) => {
          const vendorElement = document.createElement("div");
          vendorElement.className = "col-md-4 featured-responsive vendor-item";
          vendorElement.innerHTML = `
                <div class="vendor-wrap">
                    <a href="detail.html">
                        <img alt="#" class="img-fluid" src="${vendor.image}"/>
                        <div class="vendor-title-box">
                            <h6>${vendor.name}</h6>
                            <div class="rating">
                              <div class="star-rating" title="${vendor.rating}%">
                                <div class="back-stars">
                                  <i class="fa fa-star" aria-hidden="true"></i>
                                  <i class="fa fa-star" aria-hidden="true"></i>
                                  <i class="fa fa-star" aria-hidden="true"></i>
                                  <i class="fa fa-star" aria-hidden="true"></i>
                                  <i class="fa fa-star" aria-hidden="true"></i>

                                  <div class="front-stars" style="width: ${vendor.rating}%">
                                    <i class="fa fa-star" aria-hidden="true"></i>
                                    <i class="fa fa-star" aria-hidden="true"></i>
                                    <i class="fa fa-star" aria-hidden="true"></i>
                                    <i class="fa fa-star" aria-hidden="true"></i>
                                    <i class="fa fa-star" aria-hidden="true"></i>
                                  </div>
                                </div>
                                <span></span>
                                <button href="review.html" class="btn btn-outline-light">
                                  Rate
                                </button>
                              </div>
                            </div>
                            <p>${vendor.type}</p>
                            <ul class="address">
                                <li><span class="icon-screen-smartphone"></span><p>${vendor.phone}</p></li>
                                <li><span class="icon-link"></span><p>${vendor.social}</p></li>
                            </ul>
                        </div>
                    </a>
                </div>
            `;
          fragment.appendChild(vendorElement);
        });

        vendorList.appendChild(fragment);
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadVendors();
        window.addEventListener("scroll", handleScroll);
        document
          .getElementById("vendorSearch")
          .addEventListener("input", handleSearch);
        document
          .getElementById("searchCriteria")
          .addEventListener("change", handleSearch);
      });
    </script>
  </body>
</html>
