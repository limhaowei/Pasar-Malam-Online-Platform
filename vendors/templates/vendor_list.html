<!-- registration/templates/vendor_list.html -->
{% extends 'main.html' %} {% load static %} {% block content %}
<section class="main-block light-bg" id="vendors">
  <div class="container">
    <div class="row mb-3">
      <div class="col-md-4">
        <select id="searchCriteria" class="form-section search">
          <option value="name">Search by Name</option>
          <option value="business_type">Search by Business Type</option>
        </select>
      </div>
      <div class="col-md-8">
        <input
          id="vendorSearch"
          class="form-section search"
          placeholder="Search for vendors..."
        />
      </div>
    </div>
    <div class="row" id="vendor-list">
      <!-- Vendors will be loaded here -->
      {% for vendor in vendors %}
      <div class="col-md-4 featured-responsive vendor-item">
        <div class="vendor-wrap">
          <a href="{% url 'vendor_detail' vendor.pk %}">
            <img alt="#" class="img-fluid" src="{{vendor.product_picture}}" />
            <div class="vendor-title-box">
              <h6>{{vendor.name}}</h6>
              <!-- <div class="rating">
                <div class="star-rating" title="{{vendor.rating|default:'0'}}%">
                  <div class="back-stars">
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>
                    <i class="fa fa-star" aria-hidden="true"></i>

                    <div
                      class="front-stars"
                      style="width: '{{vendor.rating|default:'0'}}%"
                    >
                      <i class="fa fa-star" aria-hidden="true"></i>
                      <i class="fa fa-star" aria-hidden="true"></i>
                      <i class="fa fa-star" aria-hidden="true"></i>
                      <i class="fa fa-star" aria-hidden="true"></i>
                      <i class="fa fa-star" aria-hidden="true"></i>
                    </div>
                  </div>
                  <a
                    href="#"
                    class="btn btn-outline-light rate-btn"
                    data-bs-toggle="modal"
                    data-bs-target="#rateModal"
                  >
                    Rate
                  </a>
                </div>
              </div> -->

              <p>{{vendor.product_type}}</p>
              <ul class="address">
                <li>
                  <span class="icon-screen-smartphone"></span>
                  <p>{{vendor.phone_number}}</p>
                </li>
                <li>
                  <span class="icon-link"></span>
                  <p>{{vendor.social_media_alias}}</p>
                </li>
              </ul>
            </div>
          </a>
        </div>
      </div>
      {% empty %}
      <p>No vendors yet.</p>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Rate Modal -->
<div class="modal fade" id="rateModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="rateModalLabel">Rate Vendor</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          onclick="resetForm()"
        ></button>
      </div>
      <div class="modal-body">
        <form id="rateForm">
          <div class="star-widget">
            <input type="radio" name="rate" id="rate1" />
            <label for="rate1" class="fa fa-star"></label>
            <input type="radio" name="rate" id="rate2" />
            <label for="rate2" class="fa fa-star"></label>
            <input type="radio" name="rate" id="rate3" />
            <label for="rate3" class="fa fa-star"></label>
            <input type="radio" name="rate" id="rate4" />
            <label for="rate4" class="fa fa-star"></label>
            <input type="radio" name="rate" id="rate5" />
            <label for="rate5" class="fa fa-star"></label>
            <div class="textarea">
              <textarea
                id="feedbackTextarea"
                cols="55"
                rows="5"
                placeholder="Describe your experience..."
              ></textarea>
            </div>
            <div class="text-center mt-3">
              <button type="submit" class="btn btn-primary" id="clear">
                Submit
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  let loadedVendors = 0;
  const vendorsPerLoad = 6;

  function resetForm() {
    document.getElementById("rateForm").reset();
  }

  function handleScroll() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight;
    const clientHeight = document.documentElement.clientHeight;

    if (scrollTop + clientHeight >= scrollHeight - 5) {
      loadVendors();
    }
  }

  function handleSearch() {
    const query = document.getElementById("vendorSearch").value.toLowerCase();
    const searchCriteria = document.getElementById("searchCriteria").value;
    const vendorList = document.getElementById("vendor-list");

    // Reset result
    vendorList.innerHTML = "";

    // Filter vendors based on the search criteria
    const filteredVendors = vendors.filter((vendor) => {
      const name = vendor.name.toLowerCase();
      const businessType = vendor.type.toLowerCase();

      if (searchCriteria === "name" && name.includes(query)) {
        return true;
      } else if (
        searchCriteria === "business_type" &&
        businessType.includes(query)
      ) {
        return true;
      }
      return false;
    });

    // Display filtered vendors
    const fragment = document.createDocumentFragment();
    filteredVendors.forEach((vendor) => {
      const vendorElement = document.createElement("div");
      vendorElement.className = "col-md-4 featured-responsive vendor-item";
      vendorElement.innerHTML = `
            <div class="vendor-wrap">
                <a href="detail.html">
                    <img alt="#" class="img-fluid" src="${vendor.image}"/>
                    <div class="vendor-title-box">
                        <h6>${vendor.name}</h6>
                        <div class="rating">
                          <div class="star-rating" title="${vendor.rating}%">
                            <div class="back-stars">
                              <i class="fa fa-star" aria-hidden="true"></i>
                              <i class="fa fa-star" aria-hidden="true"></i>
                              <i class="fa fa-star" aria-hidden="true"></i>
                              <i class="fa fa-star" aria-hidden="true"></i>
                              <i class="fa fa-star" aria-hidden="true"></i>

                              <div class="front-stars" style="width: ${vendor.rating}%">
                                <i class="fa fa-star" aria-hidden="true"></i>
                                <i class="fa fa-star" aria-hidden="true"></i>
                                <i class="fa fa-star" aria-hidden="true"></i>
                                <i class="fa fa-star" aria-hidden="true"></i>
                                <i class="fa fa-star" aria-hidden="true"></i>
                              </div>
                            </div>
                            <a href="#" class="btn btn-outline-light rate-btn" data-bs-toggle="modal" data-bs-target="#rateModal">
                              Rate
                            </a>
                          </div>
                        </div>
                        <p>${vendor.type}</p>
                        <ul class="address">
                            <li><span class="icon-screen-smartphone"></span><p>${vendor.phone}</p></li>
                            <li><span class="icon-link"></span><p>${vendor.social}</p></li>
                        </ul>
                    </div>
                </a>
            </div>
        `;
      fragment.appendChild(vendorElement);
    });

    vendorList.appendChild(fragment);
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadVendors();
    window.addEventListener("scroll", handleScroll);
    document
      .getElementById("vendorSearch")
      .addEventListener("input", handleSearch);
    document
      .getElementById("searchCriteria")
      .addEventListener("change", handleSearch);
  });
</script>

{% endblock %}
